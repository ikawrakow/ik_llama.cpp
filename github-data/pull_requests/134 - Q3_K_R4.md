## ðŸ”€ [Pull Request #134](https://github.com/ikawrakow/ik_llama.cpp/pull/134) - Q3_K_R4

| **Author** | `ikawrakow` |
| :--- | :--- |
| **State** | ðŸ”€ **Merged** |
| **Source Branch** | `ik/q3_k_r4` |
| **Target Branch** | `main` |
| **Created** | 2024-12-11 |
| **Updated** | 2024-12-11 |
| **Merged** | 2024-12-11 |

---

## ðŸ“„ Description

Follow up of [#118](https://github.com/ikawrakow/ik_llama.cpp/issues/118), [#119](https://github.com/ikawrakow/ik_llama.cpp/issues/119), [#120](https://github.com/ikawrakow/ik_llama.cpp/issues/120), [#121](https://github.com/ikawrakow/ik_llama.cpp/issues/121), [#122](https://github.com/ikawrakow/ik_llama.cpp/issues/122), [#123](https://github.com/ikawrakow/ik_llama.cpp/issues/123), [#129](https://github.com/ikawrakow/ik_llama.cpp/issues/129), [#130](https://github.com/ikawrakow/ik_llama.cpp/issues/130), [#132](https://github.com/ikawrakow/ik_llama.cpp/issues/132)  for `Q3_K`. 

We get a massive speedup on `ARM_NEON` and non-negligible gains on `AVX2/Zen4`.  Here is `PP-512` for LLaMA-3.1-8B on `Zen4` (Ryzen-7950X), `ARM_NEON` (M2-Max) and `AVX2` (Ryzen-5975WX)

| Platform |  Threads | Q3_K | Q3_K_R4 | Speedup |
| ---: | ---: | ---: | ---: | ---: |
| ARM_NEON |  8 |  55.42 Â± 1.00  | 106.89 Â± 1.14  | 1.929 |
| Zen4            | 16 | 193.89 Â± 0.43   | 236.77 Â± 0.35  | 1.221 |
| AVX2           | 32 | 199.22 Â± 0.41 |  262.34 Â± 0.50  | 1.317 |

On `AVX2/Zen4` we gain even for TG. Here results for TG-128 on LLaMA-3.1-8B with different numbers of threads:

| Platform |  Threads | Q3_K | Q3_K_R4 | Speedup |
| ---: | ---: | ---: | ---: | ---: |
| Zen4            | 1 |  5.47 Â± 0.01   | 6.78 Â± 0.00 |  1.239 |
|                      | 2 |  10.25 Â± 0.00 | 12.46 Â± 0.00   |  1.216 |
|                      | 4 |  15.21 Â± 0.59  | 17.02 Â± 0.09   |  1.119 |
| AVX2           | 2 | 5.02 Â± 0.01    | 8.21 Â± 0.00  | 1.635 |
|                     | 4 | 9.33 Â± 0.00    |  13.67 Â± 0.00 | 1.465 |
|                     | 8 |  14.85 Â± 0.02  | 16.67 Â± 0.00  | 1.123 |